{% extends 'layout.html.twig' %}

{% block wrapper %}
    {{ parent() }}    

    <div class="content-wrapper">
    {# Progress bar #}
    <div class="progress no-border hidden" id="delete-progress">
        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
            <span class="sr-only">Cargando...</span>
        </div>
    </div>  

    {{ include('JcObdulioBundle:Default:messages/success.html.twig') }}
    {{ include('JcObdulioBundle:Default:messages/danger.html.twig') }}
            
    <section class="content-header">
      <h1>
        Reporte de Producci√≥n: Operativos
        {#<small>it all starts here</small>#}
      </h1>
      <ol class="breadcrumb">
        <li><a href="{{ path('inicio') }}"><i class="glyphicon glyphicon-home"></i> Inicio</a></li>
        <li><a href="{{ path('inicio') }}"><i class="glyphicon glyphicon-copy"></i> Reportes</a></li>
        <li><a class="active">Operativo</a></li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">

      <!-- Default box -->
      <div class="box">        
        <div class="box-body">
            {#<div class="table-responsive">#}
                <table id="example1" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Unidad</th>
                            <th>Tipo Producto</th>
                            <th>Producto</th>
                            <th>Plan</th>
                            <th>Real</th>
                            <th>Diferencia</th>
                        </tr>
                     </thead>
                     <tbody>                     
                     {% for item in listado %}        
                        {% if "now"|date("m") == 1 %} 
                            {% set plan = item.enero %}      
                        {% endif %}        
                        {% if "now"|date("m") == 2 %} 
                            {% set plan = item.febrero %}   
                        {% endif %}           
                        {% if "now"|date("m") == 3 %} 
                            {% set plan = item.marzo %}              
                        {% endif %}
                        {% if "now"|date("m") == 4 %} 
                            {% set plan = item.abril %} 
                        {% endif %}             
                        {% if "now"|date("m") == 5 %} 
                            {% set plan = item.mayo %}              
                        {% endif %}
                        {% if "now"|date("m") == 6 %} 
                            {% set plan = item.junio %}              
                        {% endif %}
                        {% if "now"|date("m") == 7 %} 
                            {% set plan = item.julio %}              
                        {% endif %}
                        {% if "now"|date("m") == 8 %} 
                            {% set plan = item.agosto %}              
                        {% endif %}
                        {% if "now"|date("m") == 9 %} 
                            {% set plan = item.septiembre %}              
                        {% endif %}
                        {% if "now"|date("m") == 10 %} 
                            {% set plan = item.octubre %}              
                        {% endif %}
                        {% if "now"|date("m") == 11 %} 
                            {% set plan = item.noviembre %}              
                        {% endif %}
                        {% if "now"|date("m") == 12 %} 
                            {% set plan = item.diciembre %} 
                        {% endif %}             
                        <tr>
                            <td>{{ item.unidad }}</td>
                            <td>{{ item.tipo }}</td>
                            <td>{{ item.producto }}</td>
                            <td>{{ plan }}</td>
                            <td>{{ item.real }}</td>                            
                            <td>{{ plan - item.real }}</td>                            
                        </tr>
                    {% endfor %}
                     </tbody>
                     <tfoot>
                     <tr>
                         <th rowspan="1" colspan="1"><input placeholder="Unidad" type="text"></th>
                         <th rowspan="1" colspan="1"><input placeholder="Tipo Producto" type="text"></th>
                         <th rowspan="1" colspan="1"><input placeholder="Producto" type="text"></th>
                         <th rowspan="1" colspan="1"><input placeholder="Plan" type="text"></th>
                         <th rowspan="1" colspan="1"><input placeholder="Real" type="text"></th>
                         <th rowspan="1" colspan="1"><input placeholder="Diferencia" type="text"></th>  
                         <th></th>
                     </tr>
                     </tfoot>
                </table>  
             </div>
        </div>
        <div class="box-footer with-border">
            <div class="col-md-8 text-right"><label class="form-control">Ver totales por tipo de Producto</label></div>
            <div class="col-md-3">
                <select class="form-control" id="selectTipos">
                    <option disabled selected>Seleccione el tipo de producto</option>
                    {% for tipo in tiposProducto %}
                        <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-1">
                <a href="#" id="btnTotales" class="btn btn-default">Ver total</a>
            </div>
        </div>
      </div>
      <!-- /.box -->

    </section>
    <!-- /.content -->
  </div>

{% endblock %}

{% block javascripts  %}
	{{ parent() }}
	<script src="{{ asset('bundles/rh/js/delete-user.js') }}"></script>
        <script src="{{ asset('public/datatables.net/js/jquery.dataTables.min.js') }}"></script>
        <script src="{{ asset('public/datatables.net-bs/js/dataTables.bootstrap.min.js') }}"></script>        
        <script src="{{ asset('public/export/buttons.html5.min.js') }}"></script>
        <script src="{{ asset('public/export/buttons.print.min.js') }}"></script>
        <script src="{{ asset('public/export/dataTables.buttons.min.js') }}"></script>
        <script src="{{ asset('public/export/jszip.min.js') }}"></script>
        <script src="{{ asset('public/export/pdfmake.min.js') }}"></script>
        <script src="{{ asset('public/export/vfs_fonts.js') }}"></script>   
        <script src="{{ asset('public/export/buttons.colVis.min.js') }}"></script>       
        
        <script>
            $(function () {
                $("#selectTipos").change(function() {
                    var idTipo = $(this).val();
                    console.log(idTipo);
                    $("#btnTotales").attr('href', "{{ path('reporte_totales', { id: 2}) }}");//no se como entrar un parametro a la conversion de la url
                });
                var table = $("#example1").DataTable({
                   paging       : true,
                   lengthChange : true,
                   searching    : true,
                   ordering     : true,
                   info         : true,
                   autoWidth    : false,
                   dom          : 'Blfrtip',                              
                   buttons      : [
                        {
                            extend: 'copy',
                            text: '<i class="fa fa-files-o"></i> Copiar',
                            title: 'Reporte operativo',
                            exportOptions: {
                                columns: [ 1, 2, 3, 4 ]
                            }
                        }, 
                        {
                            extend: 'excel',
                            text: '<i class="fa fa-file-excel-o"></i> Excel',
                            title: 'Reporte operativo',
                            exportOptions: {
                                columns: [ 1, 2, 3, 4 ]
                            }
                        },
                        {
                            extend: 'pdf',
                            text: '<i class="fa fa-file-pdf-o"></i> PDF',
                            title: 'Reporte operativo',
                            exportOptions: {
                                columns: [ 1, 2, 3, 4 ]
                            }
                        }, 
                        {
                            extend: 'print',
                            text: '<i class="fa fa-print"></i> Imprimir',
                            title: 'Reporte operativo',
                            exportOptions: {
                                columns: [ 1, 2, 3, 4 ]
                            }
                        },
                        {
                            extend: 'colvis',
                            text: '<i class="fa fa-eye"></i> Columnas Visibles'
                        }
                       ],
                   language     : {
                        buttons: {
                            copyTitle: 'Copiado',
                            copySuccess: {
                                _: '%d filas al portapales',
                                1: '1 fila al portapapeles'
                            }
                        }
                       }
                });

                // Apply the search
                table.columns().every( function () {
                    var that = this;

                    $( 'input', this.footer() ).on( 'keyup change', function () {
                        if ( that.search() !== this.value ) {
                            that
                                .search( this.value )
                                .draw();
                        }
                    } );
                } );

                $('#example1 tfoot tr').appendTo('#example1 thead');

                $('input:text').attr('style', 'width: 100%');//ojo con esto, es importante sino salen muy grandes los search por columnas
                $('.dt-button').removeClass('buttons-html5');
                $('.dt-button').removeClass('buttons-copy');
                $('.dt-button').removeClass('buttons-pdf');
                $('.dt-button').removeClass('buttons-excel');
                $('.dt-button').removeClass('buttons-print');
                $('.dt-button').addClass('btn btn-sm btn-primary');
                $('.dt-button').removeClass('dt-button');
            });
        </script>
{% endblock %} 
        
{% block stylesheets %}
	{{ parent() }}
            <link rel="stylesheet" href="{{ asset('public/datatables.net-bs/css/dataTables.bootstrap.min.css') }}">
            
            <link rel="stylesheet" href="{{ asset('public/export/buttons.dataTables.min.css') }}">

    <style type="text/css" class="init">
        tfoot input {
            width: 100%;
            padding: 3px;
            box-sizing: border-box;
        }
    </style>
{% endblock %}    